import json
import requests
import pandas as pd

#the following supresses SSL HTTP warning 
#import urllib3
#urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) 
 
 
url = 'link of the url'
file_name = 'table.xlsx'
df2 = pd.DataFrame()
counter = 0
def get_identities():
    try:
        first_page = requests.get(url, verify=False, params={'size':200}, headers={'User-Agent': 'Mozilla/5.0'}).json()
        yield first_page["_embedded"]["identities"]
        num_pages = first_page["page"]["totalPages"]
        print(num_pages)
        for page in range(2,num_pages+1): # range(2,5):  # range(2,num_pages+1):
            next_page = requests.get(url,verify=False, params={'page':page, "size":200},headers={'User-Agent': 'Mozilla/5.0'}).json()
            yield next_page["_embedded"]["table_name"]
        #print(next_page)
    except:
        return("Something went wrong when trying to reach the API")
 

for page in get_identities():
    df = pd.DataFrame(page)
    df2 = df2.append(df)
    counter +=1
 
 
df2.to_excel(file_name,index=False)
print('DataFrame is written to Excel File successfully!')
print('Number of pages: {}'.format(counter))
print('Number of identities: {}'.format(len(df2.index)))


print(df2)
